<div class="flex items-center justify-between mb-4">
  <div>
    <div class="text-lg font-extrabold text-emerald-950">Reçus fiscaux</div>
    <div class="text-sm text-emerald-800/70">Renvoi / téléchargement</div>
  </div>

  <button
    class="px-4 py-2 rounded-xl bg-white/70 border border-white/40 hover:bg-white transition"
    (click)="load()"
    [disabled]="loading"
  >
    Rafraîchir
  </button>
</div>

<div *ngIf="toast" class="mb-3 rounded-xl bg-emerald-50 border border-emerald-200 px-4 py-3 text-emerald-900">
  {{ toast }}
</div>

<div *ngIf="error" class="mb-3 rounded-xl bg-red-50 border border-red-200 px-4 py-3 text-red-800">
  {{ error }}
</div>

<div *ngIf="loading" class="opacity-70">Chargement…</div>

<div *ngIf="!loading && !error">
  <div *ngIf="filtered.length === 0" class="opacity-70">Aucun reçu.</div>

  <div *ngIf="filtered.length > 0" class="overflow-x-auto">
    <table class="w-full text-sm">
      <thead>
        <tr class="text-left text-emerald-900/80">
          <th class="py-2 pr-3">N°</th>
          <th class="py-2 pr-3">Statut</th>
          <th class="py-2 pr-3">Donation</th>
          <th class="py-2 pr-3">Email</th>
          <th class="py-2 pr-3">Demandé</th>
          <th class="py-2 pr-3">Émis</th>
          <th class="py-2 pr-0 text-right">Actions</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let r of filtered" class="border-t border-white/50">
          <td class="py-3 pr-3 font-semibold text-emerald-950">
            {{ receiptLabel(r) }}
          </td>

          <td class="py-3 pr-3">
            <span
              class="inline-flex items-center px-2 py-1 rounded-lg text-xs font-semibold"
              [class]="badgeClass(r.status)"
            >
              {{ r.status }}
            </span>
          </td>

          <td class="py-3 pr-3 font-mono text-xs text-emerald-900/80">
            {{ r.donationId }}
          </td>

          <td class="py-3 pr-3">
            {{ r.emailMasked }}
          </td>

          <td class="py-3 pr-3">
            {{ r.requestedAt | date:'short' }}
          </td>

          <td class="py-3 pr-3">
            {{ r.issuedAt ? (r.issuedAt | date:'short') : '—' }}
          </td>

          <td class="py-3 pr-0">
            <div class="flex justify-end gap-2">
              <button
                class="px-3 py-2 rounded-xl bg-emerald-600 text-white hover:bg-emerald-700 disabled:opacity-60"
                (click)="resend(r.id)"
                [disabled]="busyId === r.id"
              >
                {{ busyId === r.id ? 'Renvoi…' : 'Renvoyer' }}
              </button>

              <button
                class="px-3 py-2 rounded-xl bg-white/70 border border-white/40 hover:bg-white"
                (click)="downloadPdf(r)"
              >
                PDF
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>

    <div class="mt-4 flex items-center gap-2">
      <button (click)="prevPage()" [disabled]="page === 0">Précédent</button>

      <span>
        Page {{ page + 1 }} / {{ pageData.totalPages || 1 }}
      </span>

      <button (click)="nextPage()" [disabled]="page + 1 >= (pageData.totalPages || 1)">Suivant</button>
    </div>
  </div>
</div>
