<div class="flex flex-col h-full">

  <div class="px-6 py-5 border-b border-emerald-100/50 bg-white/40 flex flex-col sm:flex-row sm:items-center justify-between gap-4">
    <div>
      <h2 class="text-xl font-extrabold text-emerald-950">Latest donations</h2>
      <p class="text-xs text-emerald-800/60 font-medium mt-0.5">Overview of recent transactions.</p>
    </div>

    <div class="relative group">
      <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
        <svg class="h-4 w-4 text-emerald-900/40 group-focus-within:text-emerald-600 transition-colors" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
        </svg>
      </div>
      <input type="text"
             placeholder="Search for a donation..."
             class="pl-9 pr-4 py-2 bg-white border border-emerald-100 rounded-xl text-sm text-emerald-900 focus:outline-none focus:ring-2 focus:ring-emerald-500/20 focus:border-emerald-400 transition-all w-full sm:w-64 placeholder:text-emerald-900/30">
    </div>
  </div>

  <div class="flex-1 overflow-auto relative">

    <div *ngIf="error" class="m-6 p-4 bg-red-50 border border-red-100 rounded-xl flex items-center gap-3 text-red-800">
      <svg class="w-5 h-5 shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
      <span class="text-sm font-medium">{{ error }}</span>
    </div>

    <div *ngIf="loading" class="p-6 space-y-4 animate-pulse">
      <div *ngFor="let i of [1,2,3,4,5]" class="h-16 bg-emerald-900/5 rounded-xl w-full"></div>
    </div>

    <div *ngIf="!loading && !error && filtered.length === 0" class="h-full flex flex-col items-center justify-center text-emerald-900/40 p-10">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-16 h-16 mb-4 opacity-50">
        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 6.375c0 2.278-3.694 4.125-8.25 4.125S3.75 8.653 3.75 6.375m16.5 0c0-2.278-3.694-4.125-8.25-4.125S3.75 4.097 3.75 6.375m16.5 0v11.25c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125V6.375m16.5 0v3.75m-16.5-3.75v3.75m16.5 0v3.75C20.25 16.153 16.556 18 12 18s-8.25-1.847-8.25-4.125v-3.75m16.5 0c0 2.278-3.694 4.125-8.25 4.125s-8.25-1.847-8.25-4.125" />
      </svg>
      <p class="font-medium">No donations found at the moment.</p>
    </div>

    <table *ngIf="!loading && !error && filtered.length > 0" class="w-full text-left border-collapse">
      <thead class="bg-emerald-50/50 sticky top-0 z-10 backdrop-blur-sm">
      <tr>
        <th class="py-4 px-6 text-[11px] font-bold text-emerald-900/50 uppercase tracking-widest">Date</th>
        <th class="py-4 px-6 text-[11px] font-bold text-emerald-900/50 uppercase tracking-widest">Donor</th>
        <th class="py-4 px-6 text-[11px] font-bold text-emerald-900/50 uppercase tracking-widest">Amount</th>
        <th class="py-4 px-6 text-[11px] font-bold text-emerald-900/50 uppercase tracking-widest text-center">Status</th>
        <th class="py-4 px-6 text-[11px] font-bold text-emerald-900/50 uppercase tracking-widest text-right">Action</th>
      </tr>
      </thead>
      <tbody class="divide-y divide-emerald-100/60">
      <tr *ngFor="let d of filtered" class="group hover:bg-emerald-50/40 transition-colors duration-150 cursor-default">

        <td class="py-4 px-6">
          <div class="text-sm font-semibold text-emerald-900">{{ d.createdAt | date:'dd MMM yyyy' }}</div>
          <div class="text-xs text-emerald-900/40 font-mono">{{ d.createdAt | date:'HH:mm' }}</div>
        </td>

        <td class="py-4 px-6">
          <div class="flex items-center gap-3">
            <div class="w-8 h-8 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600 text-xs font-bold">
              {{ (d.emailMasked || '?').charAt(0) | uppercase }}
            </div>
            <span class="text-sm text-emerald-800 font-medium">{{ d.emailMasked }}</span>
          </div>
        </td>

        <td class="py-4 px-6">
            <span class="text-sm font-bold text-emerald-950">
              {{ d.amountCents / 100 | currency:d.currency:'symbol':'1.0-0' }}
            </span>
        </td>

        <td class="py-4 px-6 text-center">
            <span class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-bold capitalize border"
                  [ngClass]="{
                    'bg-emerald-100 text-emerald-700 border-emerald-200': d.status === 'PAID',
                    'bg-amber-100 text-amber-700 border-amber-200': d.status === 'PENDING' || d.status === 'CREATED',
                    'bg-red-50 text-red-700 border-red-200': d.status === 'FAILED'
                  }">
              <span class="w-1.5 h-1.5 rounded-full mr-1.5"
                    [ngClass]="{
                      'bg-emerald-500': d.status === 'PAID',
                      'bg-amber-500': d.status === 'PENDING' || d.status === 'CREATED',
                      'bg-red-500': d.status === 'FAILED'
                    }"></span>
              {{ d.status === 'PAID' ? 'Validated' : (d.status === 'PENDING' ? 'Pending' : d.status) }}
            </span>
        </td>

        <td class="py-4 px-6 text-right">
          <button class="text-emerald-300 hover:text-emerald-600 p-2 hover:bg-emerald-100 rounded-lg transition-all">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" class="w-5 h-5">
              <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5" />
            </svg>
          </button>
        </td>
      </tr>
      </tbody>
    </table>
  </div>

  <div class="px-6 py-4 border-t border-emerald-100/50 bg-emerald-50/30 flex items-center justify-between shrink-0">
    <div class="text-xs text-emerald-900/50 font-medium">
      Page {{ pageData.page + 1 }} of {{ pageData.totalPages || 1 }}
    </div>

    <div class="flex gap-2">
      <button (click)="prevPage()"
              [disabled]="page === 0"
              class="px-3 py-1.5 rounded-lg border border-emerald-200 bg-white text-emerald-800 text-xs font-bold shadow-sm hover:bg-emerald-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
        Previous
      </button>
      <button (click)="nextPage()"
              [disabled]="pageData.last"
              class="px-3 py-1.5 rounded-lg border border-emerald-200 bg-white text-emerald-800 text-xs font-bold shadow-sm hover:bg-emerald-50 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
        Next
      </button>
    </div>
  </div>

</div>
